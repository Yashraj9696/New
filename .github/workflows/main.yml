name: Process Video

on:  
  push:  
    branches: [ main ]  
  workflow_dispatch:  

jobs:  
  process_video:  
    runs-on: ubuntu-latest  

    steps:  
      - name: Checkout Repository  
        uses: actions/checkout@v4  

      - name: Install Dependencies  
        run: |  
          sudo apt update  
          sudo apt install -y ffmpeg wget  

      - name: Download Input Video  
        run: |  
          wget -O "[Toonworld4all] Doraemon (2005) S21E18 720p x264 Multi Audio [Uncut]" "http://gfs214n102.userstorage.mega.co.nz/dl/b5tjnMp9xxevWgIUSRz7DVxn9eCpxy1icNrYjWePYLGTIpgWVuz_IcabyQamoe3RHm4lIFFuxNkBFX0IKDdIluANB_R5vCaERZmeCvdvZ_KHdPhRXRjBWbyUcRzu_4eVWiq6SlNpOTvxjerGz_hksXqIFfy-a7qsYozz1Ecmx0rWBGXDVE8NNVWON-Y4L0hf-2yRqHx3CPzsHTxr06OQNsZ6_DzN58VJf3x-sm_XQZ6PV4ackdernYDehg"  

      - name: Verify Downloaded Video  
        run: |  
          if [ ! -s [Toonworld4all] Doraemon (2005) S21E18 720p x264 Multi Audio [Uncut] ]; then  
            echo "ERROR: Input video is missing or empty!"  
            exit 1  
          fi  
          file [Toonworld4all] Doraemon (2005) S21E18 720p x264 Multi Audio [Uncut]  

      - name: Convert Video Format (if needed)  
        run: |  
          ffmpeg -i [Toonworld4all] Doraemon (2005) S21E18 720p x264 Multi Audio [Uncut] -c:v libx264 -preset fast -crf 23 -c:a aac -b:a 128k output.mp4  

      - name: Run Sketch Effect Script  
        run: |  
          python sketch.py output.mp4 processed.mp4  

      - name: Check Output File  
        run: |  
          if [ ! -s processed.mp4 ]; then  
            echo "ERROR: Processed video is missing or empty!"  
            exit 1  
          fi  

      - name: Upload Processed Video to GitHub Artifacts  
        uses: actions/upload-artifact@v4  
        with:  
          name: processed-video  
          path: processed.mp4
