name: Process Video

on:  
  push:  
    branches: [ main ]  
  workflow_dispatch:  

jobs:  
  process_video:  
    runs-on: ubuntu-latest  

    steps:  
      - name: Checkout Repository  
        uses: actions/checkout@v3  

      - name: Install Dependencies  
        run: |  
          sudo apt update  
          sudo apt install -y ffmpeg wget  

      - name: Download Input Video  
        run: |  
          wget -O "Doraemon_S20E02.mkv" "http://gfs204n110.userstorage.mega.co.nz/dl/fn9YrF9T-hMa7gKQoJUc3r1HBLM7KmLmP3rCS6iFU2BeAI5kOgIBGiKtka1gnrzWoV1NjB4oNOGQXJ8fK805zNh6VTZuHBISJmDIPZjs1KaJ-MuJRTuYabDhJblHVh6JfYovQZLdZ4YmW1woXiGzjzSX18T2LC7L-eJdF-VynOOE_yyTRpTOtvPaVpS6jxn2l-enRqcHCaWWuRHIkCq7Pk5tPXo0l53MwlWuTaqepzMA3X-UZTNILSIQsw"  

      - name: Verify Downloaded Video  
        run: |  
          if [ ! -s Doraemon_S20E02.mkv ]; then  
            echo "ERROR: Input video is missing or empty!"  
            exit 1  
          fi  
          file Doraemon_S20E02.mkv  

      - name: Convert Video Format (if needed)  
        run: |  
          ffmpeg -i Doraemon_S20E02.mkv -c:v libx264 -preset fast -crf 23 -c:a aac -b:a 128k output.mp4  

      - name: Run Sketch Effect Script  
        run: |  
          python sketch.py output.mp4 processed.mp4  

      - name: Check Output File  
        run: |  
          if [ ! -s processed.mp4 ]; then  
            echo "ERROR: Processed video is missing or empty!"  
            exit 1  
          fi  

      - name: Upload Processed Video to GitHub Artifacts  
        uses: actions/upload-artifact@v3  
        with:  
          name: processed-video  
          path: processed.mp4
